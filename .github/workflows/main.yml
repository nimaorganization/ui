name: buildAndPush
on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  buildAndPush:
    name: build and push to acr
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v2

      - name: Azure Login
        uses: azure/login@v3.0
        with:
          client-id: "26639a35-b97f-446d-96f8-80aba820cf1b"
          tenant-id: "90c2d389-705b-4327-885c-ab24afe7aa51"
          subscription-id: "77312bdf-fff4-4e77-9d06-5e69870a682c"

      - name: Login to ACR
        run: az acr login --name cntainer123

      - name: Build Docker Image
        run: docker build -t cntainer123.azurecr.io/hello-nima:v2 .

      - name: Push Docker Image
        run: docker push cntainer123.azurecr.io/hello-nima:v2
